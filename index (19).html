
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中秋限定手沖禮盒團</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; scroll-behavior: smooth; }
    .animate-bounce { animation: bounce 1s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(0); } }
    .scroll-mt-32 { scroll-margin-top: 8rem; }
    #loading-screen { position: fixed; inset: 0; background: #f5f5f5; display: flex; justify-content: center; align-items: center; z-index: 9999; font-size: 1.2rem; color: #666; font-weight: bold; flex-direction: column; gap: 10px; }
    #error-display { display: none; padding: 20px; background: #fee; color: #c00; border: 1px solid #faa; margin: 20px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; text-align: left; position: relative; z-index: 10000; }
  </style>
</head>
<body class="bg-[#F7F5F0]">
  <div id="loading-screen">
    <div>正在載入團購頁面...</div>
    <div style="font-size: 0.8rem; font-weight: normal; margin-top: 10px;">如果停留過久，請檢查網路連線</div>
  </div>
  <div id="error-display"></div>
  <div id="root"></div>
  
  <script>
    window.onerror = function(msg, url, line, col, error) { 
      var el = document.getElementById('error-display');
      var load = document.getElementById('loading-screen');
      if(load) load.style.display = 'none';
      el.style.display = 'block';
      el.innerHTML = '<strong>⚠️ 網頁發生錯誤：</strong><br>' + msg + '<br><small>' + (error ? error.stack : '') + '</small>';
      return false;
    }
  </script>

  <script type="text/babel">
    try {
      const { useState, useEffect } = React;
      const CONFIG = {"campaignName":"中秋限定手沖禮盒團","scriptUrl":"https://script.google.com/macros/s/AKfycbyUByNGOONehf0RW3JjIgPxLWBMzQaifMYosLagyLfTig7P-M4jELDFWhCfO33HyZTp/exec","campaignEndStr":"2025-12-09T05:22","bankInfo":{"code":"822","name":"中國信託","account":"1234-5678-9012","owner":"珈品豆行"},"mainProduct":{"id":"main-set","name":"LIMITED GIFT SET","subName":"中秋限定．職人手沖禮盒","price":1880,"displayPrice":"NT$ 1,880","originalPrice":"NT$ 2,280","image":"https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=2787&auto=format&fit=crop","tags":["限量 50 組","含手沖壺"],"desc":"這不只是一份禮物，這是一套完整的咖啡體驗。內含兩包精選單品與專屬手沖壺，讓儀式感隨手可得。"},"products":[{"id":1,"name":"PANAMA GEISHA","subName":"巴拿馬 翡翠莊園 藝妓","tags":["淺焙","日曬"],"price":1200,"displayPrice":"NT$ 1,200","originalPrice":"","image":"https://images.unsplash.com/photo-1559525839-4f34240be8b5?q=80&w=2535&auto=format&fit=crop"},{"id":2,"name":"SIGNATURE BLEND","subName":"珈品經典 義式配方","tags":["中深焙","水洗"],"price":450,"displayPrice":"NT$ 450","originalPrice":"NT$ 550","image":"https://images.unsplash.com/photo-1611854779393-1b2ae9d2251c?q=80&w=2574&auto=format&fit=crop"}],"theme":{"bg":"bg-[#F7F5F0]","text":"text-[#2C2C2C]","subText":"text-[#666666]","border":"border-[#2C2C2C]/10","cardBg":"bg-white","accent":"bg-[#A63C06] text-white","highlight":"text-[#A63C06]"},"campaignEnd":1765228920000};
      CONFIG.campaignEnd = new Date(CONFIG.campaignEnd);

      setTimeout(() => {
        const load = document.getElementById('loading-screen');
        if(load) load.style.display = 'none';
      }, 500);

      // --- Icons ---
      const IconBase = ({children, size=24, className=""}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
      );
      
      const ShoppingBag = (p) => <IconBase {...p}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconBase>;
      const Plus = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
      const Minus = (p) => <IconBase {...p}><path d="M5 12h14"/></IconBase>;
      const Check = (p) => <IconBase {...p}><path d="M20 6 9 17l-5-5"/></IconBase>;
      const Zap = (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
      const Timer = (p) => <IconBase {...p}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></IconBase>;
      const User = (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
      const Phone = (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>;
      const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
      const CreditCard = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
      const ClipboardList = (p) => <IconBase {...p}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></IconBase>;
      const Truck = (p) => <IconBase {...p}><path d="M5 18a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M18 18a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M8.2 15h7.6"/><path d="M15 15V6a3 3 0 0 0-3-3H5a3 3 0 0 0-3 3v9"/><path d="M18 15h.8a2 2 0 0 0 1.4-.6l2.2-2.2a2 2 0 0 0 .6-1.4V8a2 2 0 0 0-2-2h-3"/></IconBase>;
      const ArrowUpRight = (p) => <IconBase {...p}><path d="M7 7h10v10"/><path d="M7 17 17 7"/></IconBase>;
      const Loader2 = (p) => <IconBase {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
      const AlertCircle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
      const Ban = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></IconBase>;

      const Icons = { Bag: ShoppingBag, Plus, Minus, Check, Zap, Timer, User, Phone, MapPin, CreditCard, ClipboardList, Truck, Arrow: ArrowUpRight, Loader: Loader2, Alert: AlertCircle, List: ClipboardList, Ban };

      // --- App Components ---
      const QuantityControl = ({ quantity = 0, onIncrease, onDecrease, size = "normal", disabled = false }) => {
        const isLarge = size === "large";
        return (
          <div className={`flex items-center ${isLarge ? `gap-3 ${CONFIG.theme.cardBg} border ${CONFIG.theme.highlight.replace('text-', 'border-')}/20 p-1 pl-3 pr-1 rounded-full shadow-sm` : `gap-2 bg-black/5 rounded-full p-0.5 pr-2`}`}>
            <button onClick={(e) => { e.stopPropagation(); onDecrease(); }} disabled={quantity <= 0 || disabled} className={`${isLarge ? 'w-8 h-8' : 'w-7 h-7'} rounded-full ${CONFIG.theme.cardBg} flex items-center justify-center border ${CONFIG.theme.border} transition-colors ${(quantity <= 0 || disabled) ? 'text-gray-300 cursor-not-allowed' : `${CONFIG.theme.text} hover:bg-black hover:text-white active:scale-90`}`}><Icons.Minus size={isLarge ? 16 : 14} /></button>
            <span className={`font-bold ${CONFIG.theme.text} text-center min-w-[1.5em] ${isLarge ? 'text-lg' : 'text-sm'}`}>{quantity}</span>
            <button onClick={(e) => { e.stopPropagation(); onIncrease(); }} disabled={disabled} className={`${isLarge ? 'w-8 h-8' : 'w-7 h-7'} rounded-full ${disabled ? 'bg-gray-300 cursor-not-allowed' : CONFIG.theme.accent} flex items-center justify-center shadow-md`}>
              <Icons.Plus size={isLarge ? 16 : 14} color="white" />
            </button>
          </div>
        );
      };

      const StockProgress = () => {
        const now = new Date();
        const seed = now.getHours() + now.getDate(); 
        const percentage = Math.min(98, 60 + (seed % 35)); 
        return (
          <div className="w-full space-y-2 mb-4">
            <div className="flex justify-between items-end text-xs font-bold uppercase tracking-wider">
              <span className={`${CONFIG.theme.highlight} flex items-center gap-1`}>
                <Icons.Zap size={12} /> 熱銷搶購中
              </span>
              <span className={CONFIG.theme.subText}>已售出 {percentage}%</span>
            </div>
            <div className="w-full h-2.5 bg-black/5 rounded-full overflow-hidden">
              <div 
                className={`h-full ${CONFIG.theme.accent.split(' ')[0]} rounded-full transition-all duration-1000 ease-out relative overflow-hidden`}
                style={{ width: `${percentage}%` }}
              >
                <div className="absolute top-0 left-0 bottom-0 right-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full -translate-x-full animate-[shimmer_2s_infinite]"></div>
              </div>
            </div>
          </div>
        );
      };

      // ★ 修正重點：使用全名 days, hours, minutes, seconds ★
      const CountdownTimer = ({ targetDate, setIsExpired }) => {
        const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });
        const [isExpired, setExpiredState] = useState(false);

        useEffect(() => {
          const checkTime = () => {
            const now = new Date();
            const diff = targetDate - now;
            if (diff > 0) {
              setTimeLeft({
                days: Math.floor(diff/(1000*60*60*24)),
                hours: Math.floor((diff/(1000*60*60))%24),
                minutes: Math.floor((diff/1000/60)%60),
                seconds: Math.floor((diff/1000)%60)
              });
              setExpiredState(false);
              if (setIsExpired) setIsExpired(false);
            } else {
              setExpiredState(true);
              if (setIsExpired) setIsExpired(true);
            }
          };
          checkTime();
          const interval = setInterval(checkTime, 1000);
          return () => clearInterval(interval);
        }, [targetDate]);

        if (isExpired) {
          return (
            <div className="flex items-center justify-center gap-2 bg-red-100 text-red-600 py-3 px-6 rounded-lg mb-6 border border-red-200">
               <Icons.Ban size={20} /> <span className="font-bold text-lg tracking-widest">活動已結束</span>
            </div>
          );
        }

        return (
          <div className={`flex items-center justify-center gap-4 ${CONFIG.theme.text} bg-white/50 py-3 px-6 rounded-lg mb-6 border ${CONFIG.theme.border}`}>
            <div className={`flex items-center gap-2 text-sm font-bold ${CONFIG.theme.highlight} uppercase tracking-wider mr-2`}>
              <Icons.Timer size={16} /> 登記倒數
            </div>
            <div className="font-mono font-bold text-lg tracking-widest flex gap-1">
              <span>{String(timeLeft.days).padStart(2, '0')}</span><span className={CONFIG.theme.highlight}>:</span>
              <span>{String(timeLeft.hours).padStart(2, '0')}</span><span className={CONFIG.theme.highlight}>:</span>
              <span>{String(timeLeft.minutes).padStart(2, '0')}</span><span className={CONFIG.theme.highlight}>:</span>
              <span>{String(timeLeft.seconds).padStart(2, '0')}</span>
            </div>
          </div>
        );
      };

      const Navigation = ({ scrolled, totalItems, animateCart }) => (
        <nav className={`fixed top-0 left-0 right-0 z-50 flex justify-center transition-all duration-300 ${scrolled ? 'py-4' : 'py-6'}`}>
          <div className={`bg-white/90 backdrop-blur-md border ${CONFIG.theme.border} rounded-full px-8 md:px-10 py-3 flex items-center gap-6 md:gap-12 shadow-xl shadow-black/5`}>
            <div className={`flex items-center gap-2 font-black tracking-widest text-lg ${CONFIG.theme.text} cursor-pointer`} onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}>KAFEI.</div>
            <div className={`hidden md:flex items-center gap-8 text-sm font-medium ${CONFIG.theme.subText}`}>
              <button onClick={() => document.getElementById('main-product').scrollIntoView({behavior:'smooth'})} className={`${CONFIG.theme.text} cursor-pointer hover:opacity-70 transition-opacity font-bold border-b-2 border-transparent hover:border-current`}>主打商品</button>
              {CONFIG.products.length > 0 && (<button onClick={() => document.getElementById('addons').scrollIntoView({behavior:'smooth'})} className={`hover:${CONFIG.theme.text} cursor-pointer transition-colors font-bold border-b-2 border-transparent hover:border-current`}>加購選品</button>)}
            </div>
            <button onClick={() => document.getElementById('checkout-form').scrollIntoView({behavior:'smooth'})} className={`flex items-center gap-2 text-sm font-bold transition-all duration-300 ${animateCart ? `scale-125 ${CONFIG.theme.highlight}` : ''} ${totalItems > 0 ? CONFIG.theme.highlight : `${CONFIG.theme.text} opacity-50 hover:opacity-100`}`}>
              <div className={`relative ${animateCart ? 'animate-bounce' : ''}`}>
                <Icons.Bag size={20} className={totalItems > 0 ? "fill-current opacity-10" : ""} />
                {totalItems > 0 && (<span className={`absolute -top-2 -right-2 ${CONFIG.theme.accent} text-[10px] min-w-[18px] h-[18px] flex items-center justify-center rounded-full border-2 border-white shadow-sm`}>{totalItems}</span>)}
              </div>
              {totalItems === 0 && <span className="hidden md:inline">前往結帳</span>}
            </button>
          </div>
        </nav>
      );

      const StickyBottomBar = ({ totalItems, totalPrice }) => {
        if (totalItems === 0) return null;
        return (
          <div className={`fixed bottom-0 left-0 right-0 ${CONFIG.theme.cardBg} border-t ${CONFIG.theme.border} p-4 z-40 md:hidden shadow-[0_-5px_20px_rgba(0,0,0,0.1)] flex items-center justify-between gap-4 animate-in slide-in-from-bottom duration-300`}>
            <div className="flex flex-col"><span className={`text-xs ${CONFIG.theme.subText}`}>合計金額</span><span className={`text-xl font-bold ${CONFIG.theme.highlight}`}>NT$ {totalPrice.toLocaleString()}</span></div>
            <button onClick={() => document.getElementById('checkout-form').scrollIntoView({behavior:'smooth'})} className={`bg-black text-white px-8 py-3 rounded-xl font-bold tracking-widest hover:opacity-80 transition-colors flex items-center gap-2`}>立即結帳 <Icons.Arrow size={18} /></button>
          </div>
        );
      };

      const CheckoutForm = ({ cart, onOrderComplete }) => {
        const [loading, setLoading] = useState(false);
        const [success, setSuccess] = useState(false);
        const [formData, setFormData] = useState({ name: '', phone: '', address: '', payment: 'transfer', note: '' });
        const [touched, setTouched] = useState({ name: false, phone: false, address: false });
        
        const isFieldInvalid = (field) => touched[field] && formData[field].trim() === '';
        const inputClass = (field) => `w-full px-4 py-3 rounded-lg border outline-none transition ${CONFIG.theme.cardBg} ${isFieldInvalid(field) ? 'border-red-500 bg-red-50 focus:border-red-500 focus:ring-1 focus:ring-red-500' : `${CONFIG.theme.border} focus:border-current focus:ring-1 focus:ring-current`}`;

        const calculateTotal = () => {
          let total = 0;
          let summary = [];
          if (cart[CONFIG.mainProduct.id] > 0) {
            const qty = cart[CONFIG.mainProduct.id];
            total += CONFIG.mainProduct.price * qty;
            summary.push(`${CONFIG.mainProduct.name} x${qty}`);
          }
          CONFIG.products.forEach(p => {
            if (cart[p.id] > 0) {
              const qty = cart[p.id];
              total += p.price * qty;
              summary.push(`${p.name} x${qty}`);
            }
          });
          return { total, summary: summary.join('\n') };
        };
        const { total, summary } = calculateTotal();

        const handleSubmit = async (e) => {
          e.preventDefault();
          setTouched({ name: true, phone: true, address: true });
          if (total === 0) { alert("購物車是空的，請先選擇商品！"); return; }
          if (!formData.name || !formData.phone || !formData.address) return;
          setLoading(true);
          try {
            const submitData = new FormData();
            submitData.append('campaign_name', CONFIG.campaignName);
            submitData.append('order_items', summary);
            submitData.append('total_price', total);
            submitData.append('name', formData.name);
            submitData.append('phone', formData.phone);
            submitData.append('address', formData.address);
            submitData.append('payment', formData.payment);
            submitData.append('note', formData.note);
            submitData.append('created_at', new Date().toLocaleString());
            if (CONFIG.scriptUrl) await fetch(CONFIG.scriptUrl, { method: 'POST', body: submitData, mode: 'no-cors' });
            setSuccess(true);
          } catch (error) { alert('發生錯誤'); }
          setLoading(false);
        };

        if (success) {
          return (
            <div id="checkout-form" className={`py-20 ${CONFIG.theme.cardBg} border-t ${CONFIG.theme.border} text-center px-4`}>
               <div className={`w-20 h-20 ${CONFIG.theme.accent} rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl animate-in zoom-in duration-300`}>
                 <Icons.Check size={40} color="white" />
               </div>
               <h2 className={`text-3xl font-bold ${CONFIG.theme.text} mb-4`}>訂購登記成功！</h2>
               <p className={`${CONFIG.theme.subText} max-w-md mx-auto mb-8`}>感謝您的訂購，我們已收到您的資料。<br/>確認款項/訂單後，將會發送簡訊通知出貨。</p>
               <button onClick={() => window.location.reload()} className={`${CONFIG.theme.highlight} font-bold border-b border-current hover:opacity-80 transition-opacity`}>返回首頁</button>
            </div>
          );
        }

        return (
          <div id="checkout-form" className={`py-20 ${CONFIG.theme.cardBg} border-t ${CONFIG.theme.border} scroll-mt-20`}>
            <div className="max-w-3xl mx-auto px-6">
              <div className="text-center mb-12">
                 <div className={`inline-flex items-center justify-center p-3 ${CONFIG.theme.bg} rounded-full mb-4`}>
                   <Icons.Truck size={24} className={CONFIG.theme.highlight.replace('text-', 'text-')} />
                 </div>
                 <h2 className={`text-3xl font-bold ${CONFIG.theme.text}`}>訂購資料填寫</h2>
                 <p className={`${CONFIG.theme.subText} mt-2`}>請確認下方購買項目，並填寫收件資訊</p>
              </div>
              <div className="grid md:grid-cols-2 gap-12">
                <div className={`${CONFIG.theme.bg} p-8 rounded-2xl h-fit`}>
                  <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Icons.List size={20} /> 訂單摘要</h3>
                  {total === 0 ? (<p className={`${CONFIG.theme.subText} text-sm py-4`}>尚未選擇商品</p>) : (
                    <div className="space-y-4 mb-6">
                      {cart[CONFIG.mainProduct.id] > 0 && (<div className="flex justify-between text-sm"><span>{CONFIG.mainProduct.name} x {cart[CONFIG.mainProduct.id]}</span><span className="font-bold">NT$ {(CONFIG.mainProduct.price * cart[CONFIG.mainProduct.id]).toLocaleString()}</span></div>)}
                      {CONFIG.products.map(p => cart[p.id] > 0 && (<div key={p.id} className="flex justify-between text-sm"><span>{p.name} x {cart[p.id]}</span><span className="font-bold">NT$ {(p.price * cart[p.id]).toLocaleString()}</span></div>))}
                    </div>
                  )}
                  <div className={`border-t ${CONFIG.theme.border} pt-4 flex justify-between items-end`}><span className={`text-sm font-bold ${CONFIG.theme.subText}`}>總金額</span><span className={`text-2xl font-black ${CONFIG.theme.highlight}`}>NT$ {total.toLocaleString()}</span></div>
                </div>
                <form onSubmit={handleSubmit} className="space-y-6">
                  <div><label className={`block text-sm font-bold ${CONFIG.theme.text} mb-2 flex items-center gap-1`}><Icons.User size={16} /> 姓名 <span className="text-red-500">*</span></label><input type="text" className={inputClass('name')} placeholder="請輸入收件人姓名" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} onBlur={() => setTouched(prev => ({ ...prev, name: true }))} />{isFieldInvalid('name') && <p className="text-red-500 text-xs mt-1 flex items-center gap-1"><Icons.Alert size={12}/> 此欄位為必填</p>}</div>
                  <div><label className={`block text-sm font-bold ${CONFIG.theme.text} mb-2 flex items-center gap-1`}><Icons.Phone size={16} /> 電話 <span className="text-red-500">*</span></label><input type="tel" className={inputClass('phone')} placeholder="09xx-xxx-xxx" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} onBlur={() => setTouched(prev => ({ ...prev, phone: true }))} />{isFieldInvalid('phone') && <p className="text-red-500 text-xs mt-1 flex items-center gap-1"><Icons.Alert size={12}/> 此欄位為必填</p>}</div>
                  <div><label className={`block text-sm font-bold ${CONFIG.theme.text} mb-2 flex items-center gap-1`}><Icons.MapPin size={16} /> 地址 <span className="text-red-500">*</span></label><input required type="text" placeholder="請輸入完整收件地址" className={inputClass('address')} value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} onBlur={() => setTouched(prev => ({ ...prev, address: true }))} />{isFieldInvalid('address') && <p className="text-red-500 text-xs mt-1 flex items-center gap-1"><Icons.Alert size={12}/> 此欄位為必填</p>}</div>
                  <div>
                    <label className={`block text-sm font-bold ${CONFIG.theme.text} mb-2 flex items-center gap-1`}><Icons.CreditCard size={16} /> 付款方式</label>
                    <div className="grid grid-cols-2 gap-3">
                      <button type="button" onClick={() => setFormData({...formData, payment: 'transfer'})} className={`px-4 py-3 rounded-lg border text-sm font-bold transition ${formData.payment === 'transfer' ? `${CONFIG.theme.accent.split(' ')[0]} bg-opacity-10 ${CONFIG.theme.highlight}` : `${CONFIG.theme.border} ${CONFIG.theme.subText}`}`}>銀行轉帳</button>
                      <button type="button" onClick={() => setFormData({...formData, payment: 'cod'})} className={`px-4 py-3 rounded-lg border text-sm font-bold transition ${formData.payment === 'cod' ? `${CONFIG.theme.accent.split(' ')[0]} bg-opacity-10 ${CONFIG.theme.highlight}` : `${CONFIG.theme.border} ${CONFIG.theme.subText}`}`}>貨到付款</button>
                    </div>
                    {formData.payment === 'transfer' && (
                      <div className={`mt-3 p-4 ${CONFIG.theme.bg} border ${CONFIG.theme.border} rounded-lg text-sm ${CONFIG.theme.text} animate-in slide-in-from-top-2 duration-300`}>
                         <p className={`font-bold mb-2 flex items-center gap-2 ${CONFIG.theme.highlight}`}><Icons.CreditCard size={16} /> 匯款帳號</p>
                         <div className="space-y-1 ml-1"><p>銀行代碼：<span className="font-mono font-bold">{CONFIG.bankInfo.code}</span> ({CONFIG.bankInfo.name})</p><p>銀行帳號：<span className="font-mono font-bold select-all">{CONFIG.bankInfo.account}</span></p><p>戶名：{CONFIG.bankInfo.owner}</p></div>
                         <p className={`text-xs ${CONFIG.theme.subText} mt-3 pt-3 border-t ${CONFIG.theme.border}`}>* 請於匯款後，在下方備註欄填寫您的<span className={`${CONFIG.theme.highlight} font-bold`}>帳號後五碼</span>以利對帳。</p>
                      </div>
                    )}
                  </div>
                  <div><label className={`block text-sm font-bold ${CONFIG.theme.text} mb-2`}>備註 {formData.payment === 'transfer' ? <span className={CONFIG.theme.highlight}>(請填寫匯款後五碼)</span> : '(選填)'}</label><input type="text" className={inputClass('note')} placeholder={formData.payment === 'transfer' ? "請填寫您的匯款帳號後五碼..." : "例如：需要研磨、管理室代收..."} value={formData.note} onChange={e => setFormData({...formData, note: e.target.value})} /></div>
                  <button type="submit" disabled={loading} className={`w-full ${CONFIG.theme.accent} font-bold py-4 rounded-xl shadow-lg hover:opacity-90 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed`}>{loading ? <Icons.Loader className="animate-spin" /> : "確認送出訂單"}</button>
                </form>
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [scrolled, setScrolled] = useState(false);
        const [cart, setCart] = useState({});
        const [animateCart, setAnimateCart] = useState(false);
        const [isExpired, setIsExpired] = useState(false);
        const [targetDate, setTargetDate] = useState(CONFIG.campaignEnd);

        const totalItems = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
        const totalPrice = (() => {
          let total = 0;
          if (cart[CONFIG.mainProduct.id]) total += CONFIG.mainProduct.price * cart[CONFIG.mainProduct.id];
          CONFIG.products.forEach(p => { if (cart[p.id]) total += p.price * cart[p.id]; });
          return total;
        })();

        const updateCart = (id, delta) => {
          if (isExpired) return;
          if (delta > 0) { setAnimateCart(true); setTimeout(() => setAnimateCart(false), 300); }
          setCart(prev => {
            const newQty = Math.max(0, (prev[id] || 0) + delta);
            if (newQty === 0) { const { [id]: removed, ...rest } = prev; return rest; }
            return { ...prev, [id]: newQty };
          });
        };

        const clearCart = () => setCart({});

        useEffect(() => {
          const handleScroll = () => setScrolled(window.scrollY > 20);
          window.addEventListener('scroll', handleScroll);
          return () => window.removeEventListener('scroll', handleScroll);
        }, []);

        return (
          <div className={`min-h-screen ${CONFIG.theme.bg} ${CONFIG.theme.text} font-sans selection:${CONFIG.theme.accent.split(' ')[0]} selection:text-white relative`}>
            <Navigation scrolled={scrolled} totalItems={totalItems} animateCart={animateCart} />
            <div className="pt-32 pb-0 px-4 md:px-8 max-w-5xl mx-auto">
              <div id="main-product" className="mb-20 max-w-lg mx-auto scroll-mt-32">
                <div className="flex items-center gap-4 mb-6 justify-center"><div className={`h-px ${CONFIG.theme.border} w-12`}></div><span className={`text-xs font-bold tracking-[0.2em] ${CONFIG.theme.highlight}`}>本月主打 FEATURED</span><div className={`h-px ${CONFIG.theme.border} w-12`}></div></div>
                <div className="flex flex-col gap-6"> 
                  <div className={`relative w-full aspect-square bg-gray-200 rounded-[2rem] overflow-hidden shadow-2xl shadow-black/10 group cursor-pointer`}>
                      <img src={CONFIG.mainProduct.image} alt="Main Product" className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" onError={(e) => e.target.src = 'https://via.placeholder.com/500?text=No+Image'} />
                      <div className="absolute top-6 left-6 flex flex-col gap-2 items-start">{CONFIG.mainProduct.tags.map(tag => (<span key={tag} className={`bg-white/90 backdrop-blur px-3 py-1 rounded-full text-xs font-bold tracking-wide ${CONFIG.theme.text} shadow-sm`}>{tag}</span>))}</div>
                  </div>
                  <div className="flex flex-col text-center space-y-5 px-2">
                     <div><h2 className={`text-3xl md:text-4xl font-black ${CONFIG.theme.text} mb-2 leading-tight`}>{CONFIG.mainProduct.name}</h2><h3 className={`text-lg ${CONFIG.theme.subText} font-medium`}>{CONFIG.mainProduct.subName}</h3></div>
                     <p className={`${CONFIG.theme.subText} leading-relaxed text-base`}>{CONFIG.mainProduct.desc}</p>
                     <div className={`pt-8 border-t ${CONFIG.theme.border} w-full flex flex-col items-center gap-6`}>
                       <div className="flex items-center gap-8">
                          <div className="flex flex-col items-start">
                            {CONFIG.mainProduct.originalPrice && <div className={`text-xs ${CONFIG.theme.subText} line-through mb-1`}>{CONFIG.mainProduct.originalPrice}</div>}
                            <div className="flex items-center gap-4"><div className={`text-3xl font-bold ${CONFIG.theme.highlight}`}>{CONFIG.mainProduct.displayPrice}</div><QuantityControl quantity={cart[CONFIG.mainProduct.id]} onIncrease={() => updateCart(CONFIG.mainProduct.id, 1)} onDecrease={() => updateCart(CONFIG.mainProduct.id, -1)} size="large" disabled={isExpired} /></div>
                          </div>
                       </div>
                       
                       <CountdownTimer targetDate={targetDate} setIsExpired={setIsExpired} />
                       {!isExpired && <StockProgress />}

                       <button 
                        onClick={() => !isExpired && document.getElementById('checkout-form').scrollIntoView({behavior:'smooth'})} 
                        disabled={isExpired}
                        className={`relative w-full md:w-auto min-w-[320px] group overflow-hidden ${isExpired ? 'bg-gray-400 cursor-not-allowed' : CONFIG.theme.accent} font-bold px-8 py-6 rounded-2xl shadow-2xl hover:opacity-90 hover:scale-[1.02] transition-all duration-300 cursor-pointer`}
                       >
                         <div className="relative z-10 flex items-center justify-center gap-3">
                           <Icons.ClipboardList size={24} className={!isExpired ? "group-hover:rotate-12 transition-transform duration-300" : ""} />
                           <div className="flex flex-col items-start leading-none gap-1">
                              <span className="text-xl font-black tracking-[0.15em]">{isExpired ? "已截止" : (cart[CONFIG.mainProduct.id] > 0 ? `確認登記 (${cart[CONFIG.mainProduct.id]})` : "前往訂購登記")}</span>
                              {!isExpired && <span className="text-[10px] font-medium tracking-wider opacity-80 uppercase">Limited Time Offer</span>}
                           </div>
                           {!isExpired && <Icons.Arrow size={24} className="ml-1 group-hover:-translate-y-1 group-hover:translate-x-1 transition-transform duration-300"/>}
                         </div>
                       </button>
                     </div>
                  </div>
                </div>
              </div>
              {CONFIG.products.length > 0 && (
                <div id="addons" className={`mt-24 mb-20 border-t ${CONFIG.theme.border} pt-16 scroll-mt-32`}>
                  <div className="flex justify-between items-end mb-8 px-2"><div><h3 className={`text-2xl font-bold ${CONFIG.theme.text}`}>加購專區</h3><p className={`text-sm ${CONFIG.theme.subText} mt-1`}>搭配主打商品，享受更完整的風味旅程</p></div></div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {CONFIG.products.map((product) => {
                      const qty = cart[product.id] || 0;
                      return (
                        <div key={product.id} className={`${CONFIG.theme.cardBg} p-4 rounded-[1.5rem] border ${qty > 0 ? `${CONFIG.theme.highlight.replace('text-', 'border-')} shadow-lg` : `${CONFIG.theme.border}`} flex gap-4 md:gap-6 items-center group hover:border-current hover:shadow-xl transition-all duration-300 cursor-pointer relative overflow-hidden`}>
                           <div className={`w-24 h-24 md:w-32 md:h-32 rounded-xl bg-gray-100 overflow-hidden flex-shrink-0 relative`}>
                             <img src={product.image} alt={product.name} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" onError={(e) => e.target.src = 'https://via.placeholder.com/500?text=No+Image'} />
                             <div className={`absolute bottom-0 left-0 right-0 bg-black/80 backdrop-blur text-white text-[10px] py-1 text-center font-bold tracking-widest`}>{product.tags[0] || 'HOT'}</div>
                           </div>
                           <div className="flex-1 min-w-0 py-1">
                             <div className="flex flex-wrap gap-1 mb-2">{product.tags.map(tag => (<span key={tag} className={`text-[10px] px-2 py-0.5 rounded border ${CONFIG.theme.border} ${CONFIG.theme.subText}`}>{tag}</span>))}</div>
                             <h4 className={`font-bold ${CONFIG.theme.text} text-lg leading-tight mb-1 truncate group-hover:${CONFIG.theme.highlight.replace('text-', 'text-')} transition-colors`}>{product.name}</h4>
                             <p className={`text-xs ${CONFIG.theme.subText} mb-3`}>{product.subName}</p>
                             <div className="flex items-center justify-between mt-auto">
                               <div className="flex flex-col">
                                 {product.originalPrice && <span className="text-[10px] text-gray-400 line-through">{product.originalPrice}</span>}
                                 <span className={`font-bold ${qty > 0 ? CONFIG.theme.highlight : CONFIG.theme.text}`}>{product.displayPrice}</span>
                               </div>
                               <QuantityControl quantity={qty} onIncrease={() => updateCart(product.id, 1)} onDecrease={() => updateCart(product.id, -1)} />
                             </div>
                           </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
              <CheckoutForm cart={cart} onOrderComplete={clearCart} />
            </div>
            
            {!isExpired && totalItems > 0 && <StickyBottomBar totalItems={totalItems} totalPrice={totalPrice} />}
            
            <section className={`py-12 border-t ${CONFIG.theme.border} mt-12 ${CONFIG.theme.cardBg} mb-20 md:mb-0`}>
              <div className="max-w-7xl mx-auto px-6 text-center">
                <h2 className={`text-[10vw] md:text-[5vw] font-black tracking-tighter ${CONFIG.theme.text} opacity-10 leading-none select-none`}>KAFEI COFFEE</h2>
                <div className={`flex justify-between items-center mt-8 text-xs font-mono ${CONFIG.theme.subText} uppercase tracking-widest`}>
                  <p>© 2025 ALL RIGHTS RESERVED.</p><p>DESIGNED FOR TASTE.</p>
                </div>
              </div>
            </section>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    } catch (err) {
      document.getElementById('error-display').style.display = 'block';
      document.getElementById('error-display').innerText = '程式執行錯誤：' + err.message;
    }
  </script>
</body>
</html>
  